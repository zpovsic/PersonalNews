<html><head><link rel="import" href="../bower_components/polymer/polymer.html">

</head><body><dom-module id="news-data">

    <script>!function(){var t=[{name:"top_stories",title:"Top Stories"},{name:"doodles",title:"Doodles"},{name:"chrome",title:"Chrome"},{name:"search",title:"Search"},{name:"shopping_payments",title:"Shopping & Payments"},{name:"nonprofits",title:"Nonprofits"}],e=document.createElement("textarea");Polymer({is:"news-data",properties:{categories:{type:Array,value:t,readOnly:!0,notify:!0},categoryName:String,articleId:String,offline:Boolean,loading:{type:Boolean,readOnly:!0,notify:!0},category:{type:Object,computed:"_computeCategory(categoryName)",notify:!0},article:{type:Object,computed:"_computeArticle(category.items, articleId)",notify:!0},failure:{type:Boolean,readOnly:!0,notify:!0}},observers:["_fetchCategory(category, offline)","_fetchArticle(article, offline)"],_computeArticle:function(t,e){for(var r=0;r<t.length;++r){var i=t[r];if(i.id===e)return i}return null},_fetchArticle:function(t,e){return e&&t&&t.html||!t||this.loading?void this._setFailure(!1):void this._fetch("/data/articles/"+t.id+".html",function(t){this.set("article.html",this._formatHTML(t))}.bind(this),1,!0)},_computeCategory:function(t){for(var e,r=0;e=this.categories[r];++r)if(e.name===t)return e;return null},_fetchCategory:function(t,e,r){return e&&t&&t.items||!t||this.loading?void this._setFailure(!1):void this._fetch("/data/"+t.name+".json",function(t){this.set("category.items",this._parseCategoryItems(t))}.bind(this),r||1)},_parseCategoryItems:function(t){for(var e,r=[],i=0;e=t[i];++i)r.push({headline:this._unescapeText(e.title),href:this._getItemHref(e),id:e.id,imageUrl:this._getItemImage(e),placeholder:e.placeholder,category:e.category,timeAgo:this._timeAgo(new Date(e.time).getTime()),author:e.author,summary:this._trimRight(e.summary,100),readTime:Math.max(2,Math.round(e.contentLength/3e3))+" min read"});return r},_unescapeText:function(t){return e.innerHTML=t,e.textContent},_getItemHref:function(t){return t.id?"/article/"+this.categoryName+"/"+encodeURIComponent(t.id):null},_getItemImage:function(t){return t.imgSrc?"/data/"+t.imgSrc:""},_timeAgo:function(t){if(!t)return"";var e=(Date.now()-t)/1e3/60;if(e<2)return"1 min ago";if(e<60)return Math.floor(e)+" mins ago";if(e<120)return"1 hour ago";var r=e/60;return r<24?Math.floor(r)+" hours ago":r<48?"1 day ago":Math.floor(r/24)+" days ago"},_trimRight:function(t,e){var r=t.indexOf(" ",e);return r===-1?t:t.substr(0,r)+"..."},_formatHTML:function(t){var e=document.createElement("template");e.innerHTML=t;for(var r=e.content.querySelectorAll("img"),i=0;i<r.length;++i){var n=r[i];n.removeAttribute("width"),n.removeAttribute("height")}return e.content.querySelector(".content").innerHTML},_fetch:function(t,e,r,i){var n=new XMLHttpRequest;n.addEventListener("load",function(t){this._setLoading(!1),e(i?t.target.responseText:JSON.parse(t.target.responseText))}.bind(this)),n.addEventListener("error",function(i){r>1?this.debounce("_fetch",this._fetch.bind(this,t,e,r-1),200):(this._setLoading(!1),this._setFailure(!0))}.bind(this)),this._setLoading(!0),this._setFailure(!1),n.open("GET",t),n.send()},refresh:function(){this.categoryName&&this._fetchCategory(this.category,this.offline,3)}})}();</script>
</dom-module>
</body></html>